---
// src/components/ChatLobby.astro
export interface Props {
    title?: string;
}

const { title = "Bienvenido al Lobby" } = Astro.props;

// Configuración de tipos de chat
const chatTypes = [
    {
        type: 'text',
        label: 'Chat de Texto',
        color: 'blue',
        icon: 'M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z'
    },
    {
        type: 'voice',
        label: 'Chat de Voz',
        color: 'green',
        icon: 'M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z'
    },
    {
        type: 'video',
        label: 'Chat de Video',
        color: 'red',
        icon: 'M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z'
    }
];
---

<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white/10 backdrop-blur-md border-b border-white/20">
            <div class="container mx-auto px-6 py-4">
                <h1 class="text-3xl font-bold text-white text-center">
                    {title}
                </h1>
            </div>
        </header>

        <!-- Content -->
        <main class="flex-1 flex items-center justify-center p-6">
            <div class="w-full max-w-md">
                <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-8 shadow-2xl">
                    <!-- Form Group - Usuario -->
                    <div class="mb-6">
                        <label 
                            for="userId" 
                            class="block text-sm font-medium text-white mb-2"
                        >
                            Tu Nombre de Usuario
                        </label>
                        <input 
                            type="text" 
                            id="userId" 
                            placeholder="Ej: ana" 
                            value="user"
                            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                        />
                    </div>

                    <!-- Form Group - Sala -->
                    <div class="mb-8">
                        <label 
                            for="roomId" 
                            class="block text-sm font-medium text-white mb-2"
                        >
                            Nombre de la Sala
                        </label>
                        <input 
                            type="text" 
                            id="roomId" 
                            placeholder="Ej: sala-secreta-123" 
                            value="sala"
                            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                        />
                    </div>

                    <!-- Button Group -->
                    <div class="space-y-4">
                        <p class="text-center text-white/70 text-sm">
                            Elige el tipo de chat para crear o unirte:
                        </p>
                        
                        <div class="space-y-3">
                            {chatTypes.map(({ type, label, color, icon }) => (
                                <a 
                                    href="#" 
                                    class={`chat-button w-full flex items-center justify-center px-6 py-4 bg-${color}-600 hover:bg-${color}-700 text-white font-semibold rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg`}
                                    data-type={type}
                                >
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={icon}></path>
                                    </svg>
                                    {label}
                                </a>
                            ))}
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
    // Event listener para los botones de chat
    document.addEventListener('DOMContentLoaded', () => {
        const chatButtons = document.querySelectorAll('.chat-button');
        
        chatButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                
                const userId = (document.getElementById('userId') as HTMLInputElement)?.value.trim();
                const roomId = (document.getElementById('roomId') as HTMLInputElement)?.value.trim();
                const chatType = (e.currentTarget as HTMLAnchorElement)?.dataset?.type;
                
                if (!userId || !roomId) {
                    alert('Por favor, introduce tu nombre y el de la sala.');
                    return;
                }
                
                // Construye los query params
                const params = new URLSearchParams({
                    userId: userId,
                    roomId: roomId
                });
                
                // Redirige a la página correspondiente
                window.location.href = `/chat-${chatType}?${params.toString()}`;
            });
        });
    });
</script>